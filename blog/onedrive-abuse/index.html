<!doctype html><html lang=en><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><title>3 fun ways to (ab)use your school OneDrive storage ~ lemonsh's website</title><link href=/main.css rel=stylesheet><link href=https://lemonsh.moe/rss.xml rel=alternate title=RSS type=application/rss+xml><body><header><h1>3 fun ways to (ab)use your school OneDrive storage</h1><p>ðŸ“… 2022-08-29â€‚ ðŸ•‘ 8min</header><nav><a href=/><navitem>home</navitem></a><a href=/projects/><navitem>projects</navitem></a><a href=/blog/><navitem>blog</navitem></a></nav><hr><p>If you're a student (or a teacher) and your school/university has an Office 365 plan (e.g. for Microsoft Teams), you probably have an Education Office 365 account, which comes with a whopping 1 TB (!) of OneDrive storage and you're probably not even using 1% of that capacity. Kinda wasteful in my opinion.<p>But before I list a few fun examples of how you can make use of your school OneDrive, I need to address a few - hopefully obvious - things:<ul><li>Everything I talk about here should technically be possible with a Google Suite account (or whatever it's called), although I have no experience with that, so YMMV.<li>The administrators of your school Office 365 suite do <strong>not</strong> have access to your files, but you should also know that they have the power to <strong>reset your password</strong> and gain access that way.<li>Your account is <strong>not</strong> permanent - it will eventually be removed (e.g. when you finish school) and you need to be prepared for that.<li>The examples I'll be showing are not always the <em>best</em> solutions to a given problem, but they are definetely fun ones!</ul><p>With that out of the way, let's begin!<h1 id=rclone>rclone</h1><p>The examples I'll be covering involve the usage of <code>rclone</code> - a commandline application that allows you to easily access remote storages of various kinds.<p>On Linux it should be available in your distro's package manager and on macOS, Homebrew has it. If you use Windows, <del><a rel="noopener noreferrer" href=https://wiki.archlinux.org/title/installation_guide target=_blank>follow this guide</a></del> you can install rclone with <code>scoop</code>, but the commands may be a bit different.<p>After installation, run <code>rclone config</code> and add your OneDrive storage using the <code>onedrive</code> remote type - rclone should guide you through that. The rest of this post will assume that the name of the remote is <code>sch</code>, so always replace <code>sch</code> with <em>your</em> remote name if it's different.<h1 id=1-storing-tv-shows-movies-music-etc>#1: Storing TV Shows, Movies, Music, etc.</h1><p>The <em>"default"</em> way of storing media on OneDrive is inconvenient - gently speaking - so we're gonna use rclone to make it easier and faster. Here's a short quickstart:<h3 id=create-a-directory-for-the-media>Create a directory for the media</h3><pre class="language-sh z-code" data-lang=sh><code class=language-sh data-lang=sh><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">rclone</span></span><span class="z-meta z-function-call z-arguments z-shell"> mkdir <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>sch:anime<span class="z-punctuation z-definition z-string z-end z-shell">'</span></span></span>
</span></code></pre><h3 id=upload-media>Upload media</h3><pre class="language-sh z-code" data-lang=sh><code class=language-sh data-lang=sh><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">rclone</span></span><span class="z-meta z-function-call z-arguments z-shell"> copy<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>P</span> rezero <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>sch:anime/rezero<span class="z-punctuation z-definition z-string z-end z-shell">'</span></span></span>
</span></code></pre><p><strong>Note:</strong> When you tell rclone to copy a directory, it copies the <strong>contents</strong> of it, not the directory itself, so it's important to always specify the full destination path, as we did here.<p>By the way, the <code>-P</code> flag adds a nice progress display. If you omit it, rclone will work silently.<h3 id=download-media>Download media</h3><pre class="language-sh z-code" data-lang=sh><code class=language-sh data-lang=sh><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">rclone</span></span><span class="z-meta z-function-call z-arguments z-shell"> copy<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>P</span> <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>sch:anime/rezero/ep1.mkv<span class="z-punctuation z-definition z-string z-end z-shell">'</span></span> .</span>
</span></code></pre><h3 id=get-a-link-to-a-file-without-downloading>Get a link to a file (without downloading)</h3><pre class="language-sh z-code" data-lang=sh><code class=language-sh data-lang=sh><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">rclone</span></span><span class="z-meta z-function-call z-arguments z-shell"> link <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>sch:anime/rezero/ep1.mkv<span class="z-punctuation z-definition z-string z-end z-shell">'</span></span></span>
</span></code></pre><p><strong>Disclaimer:</strong> The generated link likely has your <strong>school name</strong> in it, so don't share it with people you don't trust!<p>We can use this command with <code>mpv</code> in order to stream a video or audio file directly without downloading it:<pre class="language-sh z-code" data-lang=sh><code class=language-sh data-lang=sh><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">mpv</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">rclone</span></span><span class="z-meta z-function-call z-arguments z-shell"> link <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>sch:anime/rezero/ep1.mkv<span class="z-punctuation z-definition z-string z-end z-shell">'</span></span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span></span>
</span></code></pre><p>You can find more rclone commands by doing <code>rclone --help</code>.<h1 id=2-image-hosting>#2: Image hosting</h1><p>Let's say you want to make a website or you just want to have your own hosting of images without exposing the end user to 3rd-party services. Why not make a proxy to your school OneDrive with a cheap VPS or a Raspberry Pi?<p><em>Note: This method requires small Linux server administration knowledge</em><p>In this example I will be using Alpine Linux, but the commands should be easily adaptable to your distribution of choice.<h3 id=setup-rclone-on-the-remote-machine>Setup rclone on the remote machine</h3><p>Just follow the <a href=https://lemonsh.moe/blog/onedrive-abuse/#rclone>rclone</a> section of this post but on your server, <strong>as root/sudo</strong> (we're going to mount the remote and that requires root permissions, so the generated rclone config file should be in the root user's home directory)<p>You'll also want to create a folder for the images:<pre class="language-sh z-code" data-lang=sh><code class=language-sh data-lang=sh><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> rclone mkdir sch:imgs</span>
</span></code></pre><h3 id=mount-the-remote>Mount the remote</h3><pre class="language-sh z-code" data-lang=sh><code class=language-sh data-lang=sh><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> mkdir /onedrive</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> rclone mount sch:imgs /onedrive<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>allow-other</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>v</span></span>
</span></code></pre><p>You should be able to access <code>/onedrive</code> as root now. If everything is working properly, you can make the rclone mount persistent using your init system. For example, this is what I made for Alpine (OpenRC):<pre class="language-sh z-code" data-lang=sh><code class=language-sh data-lang=sh><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell">!/sbin/openrc-run</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-variable z-other z-readwrite z-assignment z-shell">name</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>onedrive<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell"><span class="z-entity z-name z-function z-shell">depend</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-punctuation z-section z-parens z-end z-shell">)</span> <span class="z-punctuation z-section z-braces z-begin z-shell">{</span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">    <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">need</span></span><span class="z-meta z-function-call z-arguments z-shell"> net</span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">    <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">before</span></span><span class="z-meta z-function-call z-arguments z-shell"> nginx</span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">    <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">use</span></span><span class="z-meta z-function-call z-arguments z-shell"> logger</span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell"><span class="z-punctuation z-section z-braces z-end z-shell">}</span></span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell"><span class="z-entity z-name z-function z-shell">start</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-punctuation z-section z-parens z-end z-shell">)</span> <span class="z-punctuation z-section z-braces z-begin z-shell">{</span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">    <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">checkpath</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>f</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>m</span> 0644<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>o</span> root:root /var/log/onedrive.log</span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">    <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">rclone</span></span><span class="z-meta z-function-call z-arguments z-shell"> mount sch:imgs /onedrive<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>daemon</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>allow-other</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>v</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>log-file</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>/var/log/onedrive.log</span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell"><span class="z-punctuation z-section z-braces z-end z-shell">}</span></span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell"><span class="z-entity z-name z-function z-shell">stop</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-punctuation z-section z-parens z-end z-shell">)</span> <span class="z-punctuation z-section z-braces z-begin z-shell">{</span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">    <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">fusermount</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>uz</span> /onedrive</span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell"><span class="z-punctuation z-section z-braces z-end z-shell">}</span></span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> vim:ft=sh</span><span class="z-comment z-line z-number-sign z-shell">
</span></span></code></pre><h3 id=configuring-the-webserver>Configuring the webserver</h3><p>Setup your webserver to serve static files from /onedrive. You probably want to enable SSL too.<p>Assuming you're using Nginx, you can add a server block similar to this:<pre class="language-conf z-code" data-lang=conf><code class=language-conf data-lang=conf><span class="z-source z-genconfig"><span class="z-storage z-type z-genconfig">server </span>{
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig">    <span class="z-variable z-parameter z-genconfig">listen</span> </span>[<span class="z-keyword z-operator z-genconfig">:</span><span class="z-keyword z-operator z-genconfig">:</span>]<span class="z-keyword z-operator z-genconfig">:</span><span class="z-constant z-numeric z-genconfig">443</span> ssl http2;
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig">    <span class="z-variable z-parameter z-genconfig">merge_slashes</span> </span><span class="z-constant z-language z-genconfig">off</span>;
</span><span class="z-source z-genconfig">
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig">    <span class="z-variable z-parameter z-genconfig">server_name</span> </span>imgs<span class="z-keyword z-operator z-genconfig">.</span>lemonsh<span class="z-keyword z-operator z-genconfig">.</span>moe;
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig">    <span class="z-variable z-parameter z-genconfig">ssl_certificate</span> </span><span class="z-keyword z-operator z-genconfig">/</span>etc<span class="z-keyword z-operator z-genconfig">/</span>acme<span class="z-keyword z-operator z-genconfig">/</span>imgs<span class="z-keyword z-operator z-genconfig">.</span>lemonsh<span class="z-keyword z-operator z-genconfig">.</span>moe<span class="z-keyword z-operator z-genconfig">.</span>crt;
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig">    <span class="z-variable z-parameter z-genconfig">ssl_certificate_key</span> </span><span class="z-keyword z-operator z-genconfig">/</span>etc<span class="z-keyword z-operator z-genconfig">/</span>acme<span class="z-keyword z-operator z-genconfig">/</span>imgs<span class="z-keyword z-operator z-genconfig">.</span>lemonsh<span class="z-keyword z-operator z-genconfig">.</span>moe<span class="z-keyword z-operator z-genconfig">.</span>key;
</span><span class="z-source z-genconfig">
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig">    <span class="z-variable z-parameter z-genconfig">root</span> </span><span class="z-keyword z-operator z-genconfig">/</span>onedrive;
</span><span class="z-source z-genconfig">}
</span></code></pre><p>Of course, you need to adapt this config according to your needs.<h3 id=testing-the-proxy>Testing the proxy</h3><p>The <code>imgs</code> directory on your OneDrive should now be mapped to your domain's root. For example, in my case, <code>sch:imgs/image.png</code> is mapped to <code>https://imgs.lemonsh.moe/image.png</code>.<h3 id=naq-never-asked-questions>NAQ (never asked questions)</h3><p>Now you might ask, why can't we just use <code>rclone link</code> for the images, just like we did with your media before? Well, there are a few reasons:<ul><li>When your current OneDrive account is deleted, all links generated with <code>rclone link</code> will become invalid. With a proxy like this, you can migrate the images somewhere else.<li>As I've said before, links generated with <code>rclone link</code> are likely to contain your school name, which is not desired if you want to embed them on a website, for example.<li>You would need to run <code>rclone link</code> manually every time you wanted to publish an image, this proxy maps the entire directory instead, so there's no manual intervention required.<li>OneDrive generally isn't the fastest file host, so if you run into performance issues with the proxy, you can attempt to fix it - for example, put it behind Cloudflare or <a rel="noopener noreferrer" href=https://rclone.org/commands/rclone_mount/#vfs-file-caching target=_blank>enable the VFS cache in rclone</a>.</ul><p>Another question you might have is, why images specifically? Why not music / videos / etc.?<p>Well, you can technically host any kind of content with this proxy, but I just felt like image hosting is a good demo usecase. Larger files are going to be problematic because for every request, your server needs to use <code>2 * filesize</code> of bandwidth (download from OneDrive and then upload to the user) and caching may be unfeasible.<h1 id=3-storing-personal-data-securely>#3: Storing personal data securely</h1><p>It's well-known that storing sensitive information in the cloud is a very bad idea, especially with non-private services like OneDrive or Google Drive, because these companies can access your data whenever they want - or when the government wants.<p>But, we can use the <code>crypt</code> remote type to mitigate this:<blockquote><p>Rclone <code>crypt</code> remotes encrypt and decrypt other remotes. A remote of type <code>crypt</code> does not access a storage system directly, but instead wraps another remote, which in turn accesses the storage system.</blockquote><p>Considering that we're working with sensitive data here, if you have trouble understanding something here, please <a rel="noopener noreferrer" href=https://rclone.org/crypt/ target=_blank>RTFM</a>. With that in mind, let's begin:<h3 id=create-an-empty-folder-for-the-encrypted-files>Create an empty folder for the encrypted files</h3><pre class="language-sh z-code" data-lang=sh><code class=language-sh data-lang=sh><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">rclone</span></span><span class="z-meta z-function-call z-arguments z-shell"> mkdir sch:enc</span>
</span></code></pre><h3 id=create-a-crypt-wrapper>Create a <code>crypt</code> wrapper</h3><p>Run <code>rclone config</code> and create a new remote of type <code>crypt</code> (instead of <code>onedrive</code> like we did before). I'll call it <code>esch</code>, but you can pick any other name. There are a few things you should know:<ul><li><code>remote</code> should be the empty folder you created in the previous step, e.g. <code>sch:enc</code>.<li>The most secure variant for <code>filename_encryption</code> is <code>standard</code>, but it has <a rel="noopener noreferrer" href=https://rclone.org/crypt/#name-encryption target=_blank>a few implications</a>, so you might wanna choose <code>obfuscate</code> instead if you think they might be a problem for you.<li>You should always generate a random password for security. 128 bits should be a secure enough option.</ul><h3 id=upload-something>Upload something!</h3><p>You should be able to use the <code>esch</code> remote just like any other rclone remote now. The only difference is that its root is mapped to the directory you specified before (e.g. <code>sch:enc</code>) and everything going through it is encrypted. So, let's try uploading something now:<pre class="language-sh z-code" data-lang=sh><code class=language-sh data-lang=sh><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">rclone</span></span><span class="z-meta z-function-call z-arguments z-shell"> copy<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>P</span> Pictures/miku-smol.png esch:</span>
</span></code></pre><p>Let's check if the file was actually uploaded:<pre class="language-sh z-code" data-lang=sh><code class=language-sh data-lang=sh><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> rclone lsf esch:</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">miku-smol.png</span></span>
</span></code></pre><p>It was! But how does it look from OneDrive's perspective?<figure><img alt="`enc` folder on my OneDrive" src=https://imgs.lemonsh.moe/20220828/onedrive.png><figcaption><code>enc</code> folder on my OneDrive</figcaption></figure> As you can see, the file has been encrypted along with its filename. <h3 id=important-reminder>Important reminder</h3><p>Obviously, this doesn't prevent you from uploading sensitive files through the unencrypted <code>sch</code> remote or even the OneDrive web interface, so remember to always handle sensitive data through <code>esch</code>.<h1 id=config-encryption-and-backup>Config encryption and backup</h1><p>Your rclone config contains passwords to all of the cloud remotes, so it's wise to protect it somehow. You can do that in <code>rclone config</code> by choosing the <code>s) Set configuration password</code> option. Upon doing that, you will be asked for a password on every rclone operation. You can always remove the password if you want (e.g. to make manual changes to the config).<p>In order to backup or migrate all your rclone remotes (including <code>crypt</code> if you set that up), you can just copy the entire config file to - for example - a password manager or a different machine. This will work even when you set a password on the file.<p>The path to the config is <code>~/.config/rclone/rclone.conf</code>.<h1 id=the-end>The end.</h1><script async crossorigin data-category=Posts data-category-id=DIC_kwDOGenHOs4CBSqT data-emit-metadata=0 data-input-position=bottom data-lang=en data-mapping=pathname data-reactions-enabled=1 data-repo=lemon-sh/lemonsh.moe data-repo-id=R_kgDOGenHOg data-theme=transparent_dark src=https://giscus.app/client.js></script><hr><a class=footer href=#>â†‘ top â†‘</a>